/**
 * Deconvolution (Lucy-Richardson Algorithm)
 */


list = findfile("test.fits")

nlucy = 4000

for i=1, nelements(list) {
	print list[i]
	image = readfits(list[i])
	psf = readfits("psf.fits")
	psf = resize(psf,naxis1(image),naxis2(image))
	psf = center(psf)
	psf /= max(psf)
	lucy = lucy(image,psf,nlucy)
	lucy = smooth(lucy,2)
	writefits list[i], lucy
}

cd ".."

print "Please add header information to the output files."
